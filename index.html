<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Elma Sapanı: Sonsuz Yolculuk</title>
    <style>
        body {
            background-color: #F8F8F8;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            flex-direction: column;
            color: #555;
        }
        canvas {
            border: 4px dashed #A0A0A0;
            background-color: #B2EBF2; /* Pastel mavi gökyüzü */
            box-shadow: 5px 5px 15px rgba(0,0,0,0.1);
        }
        #ui {
            margin-top: 25px;
            font-size: 1.5em;
            text-align: center;
        }
        #restartButton {
            display: none;
            margin-top: 15px;
            padding: 12px 25px;
            font-size: 1em;
            cursor: pointer;
            background-color: #FFC107;
            border: 2px solid #FF9800;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        #restartButton:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <div id="ui">
        <p id="scoreText">Skor: 0</p>
        <p id="infoText">A/D tuşları ile salla, boşluk tuşu ile fırlat!</p>
        <button id="restartButton">Yeniden Dene</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreText = document.getElementById('scoreText');
        const infoText = document.getElementById('infoText');
        const restartButton = document.getElementById('restartButton');

        // Oyun Değişkenleri
        let score = 0;
        let gameState = 'ready'; // ready, swinging, flying, gameover
        const gravity = 0.2;
        let gameSpeed = 0;
        let power = 0;
        const powerMax = 100;
        const powerIncrement = 2;
        const appleInitialPos = { x: 150, y: 180 };

        let apple = { 
            x: appleInitialPos.x, y: appleInitialPos.y, 
            radius: 15, color: '#E57373', 
            vx: 0, vy: 0, 
            isAttached: true, 
            swingAngle: Math.PI / 2, 
            swingVelocity: 0, 
            swingRadius: 60 
        };

        let objects = [];
        const ground = { y: canvas.height - 70, color: '#C8E6C9' };

        // Klavye Kontrolleri
        let isPoweringUp = false;
        document.addEventListener('keydown', (e) => {
            if (gameState === 'swinging') {
                if (e.key === 'a' || e.key === 'A') {
                    apple.swingVelocity += 0.01;
                }
                if (e.key === 'd' || e.key === 'D') {
                    apple.swingVelocity -= 0.01;
                }
                if (e.key === ' ') {
                    launchApple();
                }
            }
        });

        restartButton.addEventListener('click', resetGame);

        function resetGame() {
            score = 0;
            scoreText.innerText = `Skor: 0`;
            infoText.innerText = `A/D tuşları ile salla, boşluk tuşu ile fırlat!`;
            restartButton.style.display = 'none';
            apple.x = appleInitialPos.x;
            apple.y = appleInitialPos.y;
            apple.vx = 0;
            apple.vy = 0;
            apple.isAttached = true;
            apple.swingAngle = Math.PI / 2;
            apple.swingVelocity = 0;
            power = 0;
            objects = [];
            generateNewObjects(true);
            gameState = 'swinging';
            gameLoop();
        }

        function generateNewObjects(isInitial = false) {
            let lastX = isInitial ? 350 : objects[objects.length - 1].x;
            
            for (let i = 0; i < 3; i++) {
                const type = Math.floor(Math.random() * 3);
                const gap = Math.random() * 100 + 150;
                lastX += gap;

                let newObject;
                if (type === 0) {
                    newObject = { type: 'tree', x: lastX, score: 10, width: 20, height: 150, leavesRadius: 45 };
                } else if (type === 1) {
                    newObject = { type: 'watchtower', x: lastX, score: 25, width: 60, height: 120 };
                } else {
                    newObject = { type: 'building', x: lastX, score: 50, width: 90, height: 220 };
                }
                objects.push(newObject);
            }
        }

        function launchApple() {
            apple.isAttached = false;
            // Fırlatma açısı ve gücü hesaplama
            const launchAngle = Math.PI - apple.swingAngle; // Elmanın salınımına göre fırlatma açısı
            const launchVelocity = Math.abs(apple.swingVelocity * 100);
            apple.vx = Math.cos(launchAngle) * launchVelocity;
            apple.vy = Math.sin(launchAngle) * launchVelocity;
            infoText.innerText = 'Elma fırlatıldı!';
            gameState = 'flying';
        }

        function draw() {
            // Arkaplanı temizle ve zemini çiz
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = ground.color;
            ctx.fillRect(0, ground.y, canvas.width, canvas.height - ground.y);

            // Ağacı çiz (elmanın bağlı olduğu)
            drawTree(appleInitialPos.x, ground.y, 25, 180, 50);

            // Nesneleri çiz
            for (const obj of objects) {
                if (obj.type === 'tree') {
                    drawTree(obj.x, ground.y, obj.width, obj.height, obj.leavesRadius);
                } else if (obj.type === 'watchtower') {
                    drawWatchtower(obj.x, ground.y, obj.width, obj.height);
                } else if (obj.type === 'building') {
                    drawBuilding(obj.x, ground.y, obj.width, obj.height);
                }
            }
            
            // Yörünge oku
            if (gameState === 'swinging' && Math.abs(apple.swingVelocity) > 0.001) {
                drawTrajectoryArrow();
            }

            // Elmaları çiz
            drawApple();
        }

        function drawTree(x, groundY, trunkWidth, trunkHeight, leavesRadius) {
            ctx.fillStyle = '#8D6E63';
            ctx.fillRect(x - trunkWidth / 2, groundY - trunkHeight, trunkWidth, trunkHeight);
            ctx.fillStyle = '#66BB6A';
            ctx.beginPath();
            ctx.arc(x, groundY - trunkHeight, leavesRadius, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#388E3C';
            ctx.lineWidth = 4;
            ctx.stroke();
        }

        function drawWatchtower(x, groundY, width, height) {
            ctx.strokeStyle = '#D4C4A0';
            ctx.lineWidth = 6;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(x - width / 2, groundY);
            ctx.lineTo(x, groundY - height);
            ctx.moveTo(x + width / 2, groundY);
            ctx.lineTo(x, groundY - height);
            ctx.stroke();
            ctx.fillStyle = '#D4C4A0';
            ctx.fillRect(x - width / 2, groundY - height - 10, width, height / 2 + 10);
            ctx.strokeStyle = '#5D4037';
            ctx.lineWidth = 3;
            ctx.strokeRect(x - width / 2, groundY - height - 10, width, height / 2 + 10);
            ctx.fillStyle = '#A1C7D2';
            ctx.fillRect(x - 10, groundY - height / 2 - 20, 20, 15);
            ctx.strokeStyle = '#5D4037';
            ctx.lineWidth = 2;
            ctx.strokeRect(x - 10, groundY - height / 2 - 20, 20, 15);
        }

        function drawBuilding(x, groundY, width, height) {
            ctx.strokeStyle = '#757575';
            ctx.fillStyle = '#BDBDBD';
            ctx.lineWidth = 3;
            ctx.strokeRect(x, groundY - height, width, height);
            ctx.fillRect(x, groundY - height, width, height);
            const windowW = 25;
            const windowH = 35;
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(x + 15, groundY - height + 15, windowW, windowH);
            ctx.fillRect(x + 50, groundY - height + 15, windowW, windowH);
            ctx.fillRect(x + 15, groundY - height + 65, windowW, windowH);
            ctx.fillRect(x + 50, groundY - height + 65, windowW, windowH);
        }

        function drawApple() {
            if (apple.isAttached) {
                // Sallanan ip
                ctx.beginPath();
                ctx.moveTo(appleInitialPos.x, appleInitialPos.y - 60);
                ctx.lineTo(apple.x, apple.y);
                ctx.strokeStyle = '#A0A0A0';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            // Kırmızı elma
            ctx.fillStyle = apple.color;
            ctx.beginPath();
            ctx.arc(apple.x, apple.y, apple.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#C62828';
            ctx.lineWidth = 3;
            ctx.stroke();
        }

        function drawTrajectoryArrow() {
            const launchAngle = Math.PI - apple.swingAngle;
            const launchVelocity = Math.abs(apple.swingVelocity * 100);
            const initialVx = Math.cos(launchAngle) * launchVelocity;
            const initialVy = Math.sin(launchAngle) * launchVelocity;
            
            let simX = apple.x;
            let simY = apple.y;
            let simVx = initialVx;
            let simVy = initialVy;
            let path = [];

            // 60 kare ileriye simülasyon
            for (let i = 0; i < 60; i++) {
                simVy += gravity;
                simX += simVx;
                simY += simVy;
                if (simY > ground.y) break;
                path.push({x: simX, y: simY});
            }

            ctx.beginPath();
            if (path.length > 0) {
                ctx.moveTo(apple.x, apple.y);
                path.forEach(point => ctx.lineTo(point.x, point.y));
                ctx.strokeStyle = 'rgba(255, 165, 0, 0.7)';
                ctx.lineWidth = 3;
                ctx.stroke();

                // Ok ucu
                const lastPoint = path[path.length - 1];
                const prevPoint = path[path.length - 2];
                const angle = Math.atan2(lastPoint.y - prevPoint.y, lastPoint.x - prevPoint.x);
                ctx.save();
                ctx.translate(lastPoint.x, lastPoint.y);
                ctx.rotate(angle);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(-10, 5);
                ctx.lineTo(-10, -5);
                ctx.closePath();
                ctx.fillStyle = 'rgba(255, 165, 0, 0.7)';
                ctx.fill();
                ctx.restore();
            }
        }

        function update() {
            if (gameState === 'swinging') {
                // Elma salınımı
                apple.swingAngle += apple.swingVelocity;
                apple.x = appleInitialPos.x + Math.sin(apple.swingAngle) * apple.swingRadius;
                apple.y = appleInitialPos.y + Math.cos(apple.swingAngle) * apple.swingRadius;
            } else if (gameState === 'flying') {
                // Fırlatılan elmayı güncelle
                apple.vy += gravity;
                apple.x += apple.vx;
                apple.y += apple.vy;

                // Çarpışma kontrolü
                checkCollision();

                // Nesneleri kaydır
                gameSpeed = -apple.vx;
            }

            // Nesneleri kaydır
            if (Math.abs(gameSpeed) > 0.1) {
                for (const obj of objects) {
                    obj.x += gameSpeed;
                }
                gameSpeed *= 0.95; // Yavaş yavaş durması için sürtünme ekledik
            }
            
            // Eğer en soldaki nesne ekrandan çıktıysa sil ve yeni nesne ekle
            if (objects.length > 0 && objects[0].x < -100) {
                objects.shift();
                generateNewObjects();
            }

            // Elma yere düşerse
            if (apple.y + apple.radius >= ground.y) {
                endGame("Elma yere düştü!");
            }
        }

        function checkCollision() {
            for (const obj of objects) {
                let collisionDetected = false;
                let targetX = obj.x;
                let targetY;
                let targetRadius = 0;

                if (obj.type === 'tree') {
                    targetY = ground.y - obj.height;
                    targetRadius = obj.leavesRadius;
                    const distToTree = Math.sqrt(Math.pow(apple.x - targetX, 2) + Math.pow(apple.y - targetY, 2));
                    if (distToTree < targetRadius + apple.radius) {
                        collisionDetected = true;
                    }
                } else if (obj.type === 'watchtower' || obj.type === 'building') {
                    targetY = ground.y - obj.height;
                    if (apple.x > targetX - obj.width / 2 && apple.x < targetX + obj.width / 2 &&
                        apple.y > targetY && apple.y < ground.y) {
                        collisionDetected = true;
                    }
                }
                
                if (collisionDetected) {
                    addScore(obj.score);
                    endGame("Harika bir isabet!");
                    return;
                }
            }
        }

        function addScore(points) {
            score += points;
            scoreText.innerText = `Skor: ${score}`;
        }

        function endGame(message) {
            infoText.innerText = `Oyun Bitti! ${message}`;
            restartButton.style.display = 'block';
            gameState = 'gameover';
            gameSpeed = 0;
            apple.isAttached = true; // Elmayı tekrar ağaca bağla
        }

        function gameLoop() {
            if (gameState !== 'gameover') {
                update();
                draw();
                requestAnimationFrame(gameLoop);
            }
        }

        // Oyunu başlat
        resetGame();
    </script>
</body>
</html>
